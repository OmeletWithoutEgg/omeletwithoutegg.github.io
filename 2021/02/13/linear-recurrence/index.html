<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>線性遞迴淺淺談 | 蛋餅的競程隨筆</title>
<link rel=canonical href=https://omeletwithoutegg.github.io/2021/02/13/linear-recurrence/><meta name=description content="一個廢人想寫題解，所以他想辦法弄網站"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://omeletwithoutegg.github.io/2021/02/13/linear-recurrence/"><meta property="og:site_name" content="蛋餅的競程隨筆"><meta property="og:title" content="線性遞迴淺淺談"><meta property="og:description" content="本篇將會介紹快速求線性遞迴數列某項的方法，以及Berlekamp-Massey演算法和一些在矩陣上的應用。
主要是一個整理資料還有學習筆記的功能，還有老實說這東西算是偏門又毒瘤，追求實用的人不要看XD。
Fast Linear Recurrence 首先先來介紹如何快速求線性遞迴。
定義 已知序列 $ \langle a_n \rangle $ 滿足遞迴關係 $ \displaystyle \forall i \geq k, a_i = \sum _ {j=0} ^ {k-1} s _ j a _ {i-1-j} $ ，並且已經給定 $s$ 跟 $a_0, a_1, \dots, a _ {k-1}$
現在想要求 $ a_n $ 的值，其中 $ 1 \leq k \leq 5000, 0 \leq n \leq 10^9 $
許多人大概會很快想到矩陣快速冪，複雜度是 $ \mathcal{O}(k^3 \log n) $。但我們要更快！
通靈 定義一個函數 $G$，對於形式冪級數 $f(x) = \sum c_i x^i, G(f) = \sum c_i a_i$ 。
顯然$G(f \pm g) = G(f) \pm G(g)$。
根據 $s$ 構造一個多項式 $S$"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-13T16:28:29+08:00"><meta property="article:modified_time" content="2021-02-13T16:28:29+08:00"><meta property="article:tag" content="Template"><meta property="article:tag" content="Math"><meta name=twitter:card content="summary"><meta name=twitter:title content="線性遞迴淺淺談"><meta name=twitter:description content="本篇將會介紹快速求線性遞迴數列某項的方法，以及Berlekamp-Massey演算法和一些在矩陣上的應用。
主要是一個整理資料還有學習筆記的功能，還有老實說這東西算是偏門又毒瘤，追求實用的人不要看XD。
Fast Linear Recurrence 首先先來介紹如何快速求線性遞迴。
定義 已知序列 $ \langle a_n \rangle $ 滿足遞迴關係 $ \displaystyle \forall i \geq k, a_i = \sum _ {j=0} ^ {k-1} s _ j a _ {i-1-j} $ ，並且已經給定 $s$ 跟 $a_0, a_1, \dots, a _ {k-1}$
現在想要求 $ a_n $ 的值，其中 $ 1 \leq k \leq 5000, 0 \leq n \leq 10^9 $
許多人大概會很快想到矩陣快速冪，複雜度是 $ \mathcal{O}(k^3 \log n) $。但我們要更快！
通靈 定義一個函數 $G$，對於形式冪級數 $f(x) = \sum c_i x^i, G(f) = \sum c_i a_i$ 。
顯然$G(f \pm g) = G(f) \pm G(g)$。
根據 $s$ 構造一個多項式 $S$"><link rel=stylesheet href=https://omeletwithoutegg.github.io/css/styles.f0dfa32909faa2750dc7e754bad2d1afb18c45afb01ca8bf8159fe24d8c444e0211dbedf25457d282e149442086b14381ad49a063844d41f4c1db57709e5eeb6.css integrity="sha512-8N+jKQn6onUNx+dUutLRr7GMRa+wHKi/gVn+JNjEROAhHb7fJUV9KC4UlEIIaxQ4GtSaBjhE1B9MHbV3CeXutg=="><link rel=stylesheet href=https://omeletwithoutegg.github.io/css/highlight.css><link rel=stylesheet href=https://omeletwithoutegg.github.io/css/style-dark.css><link rel=stylesheet href=https://omeletwithoutegg.github.io/css/search.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://omeletwithoutegg.github.io/images/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-0ME10Z2L0D"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0ME10Z2L0D")}</script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/about/>About</a></li><li><a href=/posts/>Posts</a></li><li><a href=/resources/>Resources</a></li><li><a href=/search/>Search</a></li><li><a href=/tags/>Tags</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://omeletwithoutegg.github.io/2021/02/06/ioicamp-2021/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://omeletwithoutegg.github.io/resources/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&text=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&title=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&is_video=false&description=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87&body=Check out this article: https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&title=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&title=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&name=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87&description=%3cp%3e%e6%9c%ac%e7%af%87%e5%b0%87%e6%9c%83%e4%bb%8b%e7%b4%b9%e5%bf%ab%e9%80%9f%e6%b1%82%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%95%b8%e5%88%97%e6%9f%90%e9%a0%85%e7%9a%84%e6%96%b9%e6%b3%95%ef%bc%8c%e4%bb%a5%e5%8f%8aBerlekamp-Massey%e6%bc%94%e7%ae%97%e6%b3%95%e5%92%8c%e4%b8%80%e4%ba%9b%e5%9c%a8%e7%9f%a9%e9%99%a3%e4%b8%8a%e7%9a%84%e6%87%89%e7%94%a8%e3%80%82%3cbr%3e%0a%e4%b8%bb%e8%a6%81%e6%98%af%e4%b8%80%e5%80%8b%e6%95%b4%e7%90%86%e8%b3%87%e6%96%99%e9%82%84%e6%9c%89%e5%ad%b8%e7%bf%92%e7%ad%86%e8%a8%98%e7%9a%84%e5%8a%9f%e8%83%bd%ef%bc%8c%e9%82%84%e6%9c%89%e8%80%81%e5%af%a6%e8%aa%aa%e9%80%99%e6%9d%b1%e8%a5%bf%e7%ae%97%e6%98%af%e5%81%8f%e9%96%80%e5%8f%88%e6%af%92%e7%98%a4%ef%bc%8c%e8%bf%bd%e6%b1%82%e5%af%a6%e7%94%a8%e7%9a%84%e4%ba%ba%e4%b8%8d%e8%a6%81%e7%9c%8bXD%e3%80%82%3c%2fp%3e%0a%3ch1%20id%3d%22fast-linear-recurrence%22%3eFast%20Linear%20Recurrence%3c%2fh1%3e%0a%3cp%3e%e9%a6%96%e5%85%88%e5%85%88%e4%be%86%e4%bb%8b%e7%b4%b9%e5%a6%82%e4%bd%95%e5%bf%ab%e9%80%9f%e6%b1%82%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e3%80%82%3c%2fp%3e%0a%3ch2%20id%3d%22%e5%ae%9a%e7%be%a9%22%3e%e5%ae%9a%e7%be%a9%3c%2fh2%3e%0a%3cblockquote%3e%0a%3cp%3e%e5%b7%b2%e7%9f%a5%e5%ba%8f%e5%88%97%20%24%20%5clangle%20a_n%20%5crangle%20%24%20%e6%bb%bf%e8%b6%b3%e9%81%9e%e8%bf%b4%e9%97%9c%e4%bf%82%20%24%20%5cdisplaystyle%20%5cforall%20i%20%5cgeq%20k%2c%20a_i%20%3d%20%5csum%20_%20%7bj%3d0%7d%20%5e%20%7bk-1%7d%20s%20_%20j%20a%20_%20%7bi-1-j%7d%20%24%20%ef%bc%8c%e4%b8%a6%e4%b8%94%e5%b7%b2%e7%b6%93%e7%b5%a6%e5%ae%9a%20%24s%24%20%e8%b7%9f%20%24a_0%2c%20a_1%2c%20%5cdots%2c%20a%20_%20%7bk-1%7d%24%3cbr%3e%0a%e7%8f%be%e5%9c%a8%e6%83%b3%e8%a6%81%e6%b1%82%20%24%20a_n%20%24%20%e7%9a%84%e5%80%bc%ef%bc%8c%e5%85%b6%e4%b8%ad%20%24%201%20%5cleq%20k%20%5cleq%205000%2c%200%20%5cleq%20n%20%5cleq%2010%5e9%20%24%3c%2fp%3e%3c%2fblockquote%3e%0a%3cp%3e%e8%a8%b1%e5%a4%9a%e4%ba%ba%e5%a4%a7%e6%a6%82%e6%9c%83%e5%be%88%e5%bf%ab%e6%83%b3%e5%88%b0%e7%9f%a9%e9%99%a3%e5%bf%ab%e9%80%9f%e5%86%aa%ef%bc%8c%e8%a4%87%e9%9b%9c%e5%ba%a6%e6%98%af%20%24%20%5cmathcal%7bO%7d%28k%5e3%20%5clog%20n%29%20%24%e3%80%82%e4%bd%86%e6%88%91%e5%80%91%e8%a6%81%e6%9b%b4%e5%bf%ab%ef%bc%81%3c%2fp%3e%0a%3ch2%20id%3d%22%e9%80%9a%e9%9d%88%22%3e%e9%80%9a%e9%9d%88%3c%2fh2%3e%0a%3cp%3e%e5%ae%9a%e7%be%a9%e4%b8%80%e5%80%8b%e5%87%bd%e6%95%b8%20%24G%24%ef%bc%8c%e5%b0%8d%e6%96%bc%e5%bd%a2%e5%bc%8f%e5%86%aa%e7%b4%9a%e6%95%b8%20%24f%28x%29%20%3d%20%5csum%20c_i%20x%5ei%2c%20G%28f%29%20%3d%20%5csum%20c_i%20a_i%24%20%e3%80%82%3cbr%3e%0a%e9%a1%af%e7%84%b6%24G%28f%20%5cpm%20g%29%20%3d%20G%28f%29%20%5cpm%20G%28g%29%24%e3%80%82%3cbr%3e%0a%e6%a0%b9%e6%93%9a%20%24s%24%20%e6%a7%8b%e9%80%a0%e4%b8%80%e5%80%8b%e5%a4%9a%e9%a0%85%e5%bc%8f%20%24S%24%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&t=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#定義>定義</a></li><li><a href=#通靈>通靈</a></li><li><a href=#結論>結論</a></li></ul><ul><li><a href=#定義-1>定義</a></li><li><a href=#步驟>步驟</a></li><li><a href=#bm-演算法的應用>BM 演算法的應用！</a><ul><li><a href=#向量矩陣的slr>向量/矩陣的SLR</a></li><li><a href=#稀疏線性方程組>稀疏線性方程組</a></li><li><a href=#稠密的轉移矩陣>稠密的轉移矩陣</a></li><li><a href=#矩陣的最小多項式>矩陣的最小多項式</a></li><li><a href=#稀疏矩陣行列式>稀疏矩陣行列式</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">線性遞迴淺淺談</h1><div class=meta><span class=author itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>2qbingxuan</span></span><div class=postdate><time datetime="2021-02-13 16:28:29 +0800 +0800" itemprop=datePublished>2021-02-13</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/template/ rel=tag>template</a>
,
<a class=tag-link href=/tags/math/ rel=tag>math</a></div></div></header><div class=content itemprop=articleBody><p>本篇將會介紹快速求線性遞迴數列某項的方法，以及Berlekamp-Massey演算法和一些在矩陣上的應用。<br>主要是一個整理資料還有學習筆記的功能，還有老實說這東西算是偏門又毒瘤，追求實用的人不要看XD。</p><h1 id=fast-linear-recurrence>Fast Linear Recurrence</h1><p>首先先來介紹如何快速求線性遞迴。</p><h2 id=定義>定義</h2><blockquote><p>已知序列 $ \langle a_n \rangle $ 滿足遞迴關係 $ \displaystyle \forall i \geq k, a_i = \sum _ {j=0} ^ {k-1} s _ j a _ {i-1-j} $ ，並且已經給定 $s$ 跟 $a_0, a_1, \dots, a _ {k-1}$<br>現在想要求 $ a_n $ 的值，其中 $ 1 \leq k \leq 5000, 0 \leq n \leq 10^9 $</p></blockquote><p>許多人大概會很快想到矩陣快速冪，複雜度是 $ \mathcal{O}(k^3 \log n) $。但我們要更快！</p><h2 id=通靈>通靈</h2><p>定義一個函數 $G$，對於形式冪級數 $f(x) = \sum c_i x^i, G(f) = \sum c_i a_i$ 。<br>顯然$G(f \pm g) = G(f) \pm G(g)$。<br>根據 $s$ 構造一個多項式 $S$</p><p>$$<br>S(x) = x^k - \sum _ {i=0} ^ {k-1} s_i x^{k-1-i}<br>$$</p><p>可以發現 $G(S) = 0$，因為代進去正好是 $a_i - \sum\limits _ {j=0} ^ {k-1} s _ j a _ {i-1-j} = 0 $。<br>而且，平移之後也會滿足遞迴關係，所以 $G(Sx) = G(Sx^2) = \dots = 0$。<br>由上面兩條可以得知，對於任何多項式$f$都有$G(Sf) = 0$。</p><p>我們想求的第$n$項，正好就是$G(x^n)$，不妨取 $\displaystyle f = \lfloor \frac{x^n}{S} \rfloor$，則$G(x^n) = G(x^n - Sf) = G(x^n \mod S)$。<br>上述$\lfloor \frac{x^n}{S} \rfloor$ 和 $x^n \mod S$ 分別是多項式帶餘除法的商和餘數。</p><h2 id=結論>結論</h2><p>證明也很快。<br>總而言之，只要求得$x^n \mod S$（注意這個東西的degree是$\mathcal{O}(k)$），再帶進$G$就能得到 $a_n$！<br>可以對$n$做類似快速冪的事情，每次算$x^{n/2} \cdot x^{n/2} \mod S$之類的，如果是mod質數的話，甚至可以利用FFT或是NTT來快速多項式帶餘除法作到總複雜度 $\mathcal{O}(k\log k \log n)$，不過超出今天的篇幅所以這邊只放$\mathcal{O}(k^2 \log n)$的寫法。<br>老實說$\mathcal{O}(k^2)$的$\mod S$比想像中好寫，只要從大到小不斷把$x^k$換成$ \sum\limits _ {i=0} ^{k-1} s_i x^{k-1-i}$ 就好</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>template</span> <span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>T fastLinearRecurrence(vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> a, vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> s, <span style=color:#66d9ef>int</span> n) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (n <span style=color:#f92672>&lt;</span> (<span style=color:#66d9ef>int</span>)a.size()) <span style=color:#66d9ef>return</span> a[n];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (s.empty()) <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// a 是前 k 項， s是遞迴關係，
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// a[i] = \sum s[j] * a[i-j-1]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> r <span style=color:#f92672>=</span> {<span style=color:#ae81ff>1</span>}; <span style=color:#75715e>// 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> e <span style=color:#f92672>=</span> {<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>}; <span style=color:#75715e>// x;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>auto</span> mul <span style=color:#f92672>=</span> [<span style=color:#f92672>&amp;</span>s](vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> a, vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> b) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// return a * b % (x^k - s)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> c(a.size() <span style=color:#f92672>+</span> b.size() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (size_t i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> a.size(); i<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (size_t j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> b.size(); j<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>                c[i<span style=color:#f92672>+</span>j] <span style=color:#f92672>+=</span> a[i] <span style=color:#f92672>*</span> b[j];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (size_t i <span style=color:#f92672>=</span> c.size()<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>; i <span style=color:#f92672>&gt;=</span> s.size(); i<span style=color:#f92672>--</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (size_t j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> s.size(); j<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>                c[i<span style=color:#f92672>-</span>j<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>+=</span> c[i] <span style=color:#f92672>*</span> s[j];
</span></span><span style=display:flex><span>        c.resize(s.size());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> c;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (n) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (n <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>            r <span style=color:#f92672>=</span> mul(r, e);
</span></span><span style=display:flex><span>        e <span style=color:#f92672>=</span> mul(e, e);
</span></span><span style=display:flex><span>        n <span style=color:#f92672>&gt;&gt;=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    T sum <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (size_t j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> r.size(); j<span style=color:#f92672>++</span>) sum <span style=color:#f92672>+=</span> r[j] <span style=color:#f92672>*</span> a[j];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sum;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>上面的<code>T</code>可以是<code>double</code>或是自定義的同餘算術型別。</p><p>不過這其實有點不太實用。通常這種線性遞迴數列的遞迴式基本上長度都是超小的常數，而需要交給電腦推的遞迴式通常都是形如$v _ i = A^i v _ 0$的形式，也就是說有很多個狀態要一起考慮，沒辦法想成單一變數的線性遞迴形式，矩陣快速冪的通用性還是比較高。後面也許會提到這種東西要怎麼算得比矩陣快速冪還快，不過如果$A$不是稀疏的也只是少一個$\log$而已。</p><h1 id=berlekamp-massey-演算法>Berlekamp-Massey 演算法</h1><p>這東西可神奇了，可以說是弱化版的OEIS。不過還有很多神奇的應用。<br>以下簡稱Berlekamp-Massey演算法為BM演算法。</p><h2 id=定義-1>定義</h2><blockquote><p>給定一個序列 $ a_0, a_1, \dots, a _ {n-1} $ ，請找出一個階數最小的線性遞迴關係 $ \langle s _ i \rangle $ ，<br>使得 $ \forall i \geq k, a_i = \sum\limits _ {j=0} ^ {k-1} s _ j a _ {i-1-j} $。其中 $k$ 即是此線性遞迴關係的階數。</p></blockquote><p>當然，求出來的遞迴關係可能不是是唯一解，也不知道能不能對應到原本的遞迴式。<br>不過可以證明，如果已知遞迴式的階數最多是 $k$ 的話，只要取前 $2k$ 項求解得到一個遞迴關係之後，任何更長的前綴都會吻合該關係，也就是說該關係是整個無限數列的最短遞迴式。<br>證明請看2019 IOI中國國家隊論文&mldr;</p><h2 id=步驟>步驟</h2><p>BM演算法包含了一些迭代法跟greedy的思維。我們由短到長逐步考慮每個前綴 $[0 .. i]$ ，假如第 $i$ 個數字加進去之後和舊的遞迴關係不吻合，我們就修正該遞迴關係。一開始遞迴式 $s$ 初始化為空。<br>修正的部份可以分成兩個case：</p><ol><li>不是第一次修正。<br>假設這次誤差叫做 $\varepsilon$ 好了，也就是 $a_i - \sum _ {j=0} ^ {k-1} s _ j a _ {i-1-j} = \varepsilon$<br>因為不是第一次修正，所以設之前有一次是在加入第 $i&rsquo;$ 個數字後修正的，該次修正之前的遞迴式為$s&rsquo;$，誤差為 $\varepsilon&rsquo;$。也就是說，$a _ {i&rsquo;} - \sum _ {j=0} ^{k&rsquo;-1} s&rsquo; _ j a _ {i&rsquo;-1-j} = \varepsilon&rsquo;$<br>可以發現，$\frac{\varepsilon}{\varepsilon&rsquo;} (a _ x - \sum _ {j=0} ^ {k&rsquo;-1} s&rsquo; _ j a _ {x-1-j})$是一個僅在 $x = i&rsquo;$ 是 $\varepsilon$，其他位置是 $0$ 的序列。在 $s&rsquo;$ 前面補 $0$ ，使得前面的項都不會被影響到，而第 $i$ 項恰好對到 $\varepsilon$ 那一項，如此兩者相消就能讓第 $i$ 項的誤差變為 $0$ 。也就是說，如果當前的 $s$ 出錯了，我們就會把 $s$ 加上「之前某次的 $s&rsquo;$ 乘上若干倍再平移」以修正該次的誤差。<br>總之就是取前面算過的東西拿來消掉新加入的項的誤差啦。至於 $i&rsquo;$ 的取法似乎是要讓要補的 $0$ 盡量少，最後的結果才會是最短的遞迴式。<br>在下面的 code 中， <code>bestPos</code>維護的是最好的 $i&rsquo;$ ； <code>best</code> 維護的是最好的 $s&rsquo;$ ，取負號之後前面補 $1$ ，然後除以 $ \varepsilon&rsquo; $</li><li>第一次修正<br>表示 $i$ 是第一個非零元素，將 $s$ 修正為 $i+1$ 個 0 ，表示前 $i+1$ 項應該會是在給定的 $k$ 項之中。<br><code>best</code> 更新成單項式 $1 / \varepsilon$</li></ol><p>總之code雖然很簡潔，但好難懂&mldr;<br>複雜度是 $\mathcal{O}(n^2)$。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>template</span> <span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> BerlekampMassey(vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> a) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>auto</span> scalarProduct <span style=color:#f92672>=</span> [](vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> v, T c) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (T <span style=color:#f92672>&amp;</span>x: v) x <span style=color:#f92672>*=</span> c;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> v;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> s, best;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> bestPos <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (size_t i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> a.size(); i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        T error <span style=color:#f92672>=</span> a[i];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (size_t j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> s.size(); j<span style=color:#f92672>++</span>) error <span style=color:#f92672>-=</span> s[j] <span style=color:#f92672>*</span> a[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>j];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (error <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (s.empty()) {
</span></span><span style=display:flex><span>            s.resize(i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>            bestPos <span style=color:#f92672>=</span> i;
</span></span><span style=display:flex><span>            best.push_back(<span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> error);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> fix <span style=color:#f92672>=</span> scalarProduct(best, error);
</span></span><span style=display:flex><span>        fix.insert(fix.begin(), i <span style=color:#f92672>-</span> bestPos <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (fix.size() <span style=color:#f92672>&gt;=</span> s.size()) {
</span></span><span style=display:flex><span>            best <span style=color:#f92672>=</span> scalarProduct(s, <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> error);
</span></span><span style=display:flex><span>            best.insert(best.begin(), <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> error);
</span></span><span style=display:flex><span>            bestPos <span style=color:#f92672>=</span> i;
</span></span><span style=display:flex><span>            s.resize(fix.size());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (size_t j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> fix.size(); j<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>            s[j] <span style=color:#f92672>+=</span> fix[j];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> s;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=bm-演算法的應用>BM 演算法的應用！</h2><p>方便起見，接下來會用SLR簡稱「最短遞迴式」。<br>終於來到我最想分享的部份。前面code可以直接當模板抄啦，就跟Dinic一樣神秘。<br>但是重點在於怎麼活用BM演算法。BM演算法對於矩陣，尤其是稀疏矩陣的相性特別好。<br>這裡大部分都是IOI 2019中國國家隊的論文來的www</p><h3 id=向量矩陣的slr>向量/矩陣的SLR</h3><p>一些 $n$ 維向量 $ \{ v_0, v_1, \dots, v _ {n-1} \} $ 的SLR怎麼求？答案是隨機生成一個向量 $u$ 跟他做內積，改求 $ \{ u^T v_0, u^T v_1, \dots, u^T v _ {t-1} \} $ 的 SLR。可以證明乘上 $u$ 之後，SLR不變的機率至少是 $1 - \frac{n}{p}$ （$p$ 是模的質數）。類似的，一些 $m \times n$ 矩陣 $ \{ A_0, A_1, \dots, A _ {t-1} \} $ 的 SLR 求法就是生成隨機向量 $u, v$ 拿去左邊右邊乘，改求 $ \{ u^T A_0 v, u^T A_1 v, \dots, u^T A _ {t-1} v \} $的SLR。正確的機率似乎至少是 $1 - \frac{n+m}{p}$ 。<br>證明用到了一個我完全不會的 Schwartz-Zippel 引理。哪那麼衰XD</p><h3 id=稀疏線性方程組>稀疏線性方程組</h3><p>求解 $Ax = b$ 即是想得到 $x = A^{-1}b$ 。考慮 $ \{ A^0b, A^1b, A^2b \dots, \} $ 的SLR，可以得知<br>$ A^kb = \sum _ {i=0} ^ {k-1} s _ {k-1-i} A^ib $。兩邊同乘 $A^{-1}$ 並移項之後可以得出<br>$$<br>A^{-1}b = -\frac{1}{s _ {k-1}}(A^{k-1}b - \sum _ {i=1} ^ {k-1} s _ {k-1-i} A^{i-1}b)<br>$$<br>注意到 $s _ {k-1} \neq 0$，否則他就不可能是最短。<br>如果 $A$ 是稀疏的，裡面有 $e$ 個非零元素，那麼依序推出 $ A^0b, A^1b, \dots, A^{2n-1}b$ 就只需要 $\mathcal{O}(n(n+e))$。<br>IOICAMP似乎有一題可以用這個搶topcoder</p><h3 id=稠密的轉移矩陣>稠密的轉移矩陣</h3><p>在前面某一段有提到，轉移長度如果不是很小的常數的話，常常會寫成像是 $v_i = A^iv_0$ 的形式，其中 $A$ 是 $n$ 階方陣而 $v_i$ 是 $n$ 維向量，我們想求的是 $v_k$。<br>直接利用矩陣快速冪的方法是 $n^3 \log k$ 的。不過，我們只需要求出前 $2n$ 項的SLR，再利用前述的 fast linear recurrence 就能得到第 $k$ 項。（不過可能要稍微改寫一下求出$x^k \mod f$之後帶進$G$的部份）可以依序求出 $v_0, v_1, \dots, v _ {2n-1}$，複雜度 $\mathcal{O}(n^3)$，後面的fast linear recurrence複雜度大概是 $\mathcal{O}(n^2\log k)$之類的。<br>例題可以去試試TIOJ 1892 owo</p><h3 id=矩陣的最小多項式>矩陣的最小多項式</h3><p>一個 $n\times n$ 方陣 $A$ 的最小多項式是 degree 最小的 $p$ 使得 $p(A) = 0$ 。By Cayley Hamilton theorem，特徵多項式正好也是一個多項式 $p$ 使得 $p(A) = 0$ ，所以最小多項式的 degree 至多是 $n$。<br>如何求？最小多項式 $p(A) = \sum c_i A^i$ ，可以發現只要求 $ \{ A^0, A^1, A^2, \dots \} $ 的 SLR 就能得到最小多項式。又，最小多項式至多 $n$ 項，故取前 $2n$ 項計算即可得到答案。</p><h3 id=稀疏矩陣行列式>稀疏矩陣行列式</h3><p>給定一個稀疏矩陣$A$想求$\det(A)$。事實上只要求得特徵方程式的常數項就可以得到行列式。<br>根據 wiki 上 Cayley Hamilton 定理的頁面，最小多項式是特徵多項式的因式，但他們可能不相等，不過他們的根集合是相同的，問題只是特徵多項式裡可能有重根。因此我們把$A$乘上一個隨機的對角矩陣$B$，可以證明$AB$沒有重根（特徵多項式與最小多項式相等）的機率至少是 $1 - \frac{2n^2 - n}{p}$。似乎同樣又是Schwartz-Zippel。<br>總之，求得 $AB$ 的特徵多項式 $p$ ，並設 $p$ 的領導係數是 $1$ （如果不是就除掉），那麼 $\det(AB)$ 就是 $(-1)^{|A|} \cdot p(0)$ 也就是 $p$ 的常數項差一個正負號。 $\det(A) = \det(AB) / \det(B)$ 就完成了。<br>這個是之前打BambooFoxCTF google and copy過別人的XD現在才來完整了解作法</p><h1 id=reference>Reference</h1><p><a href=https://codeforces.com/blog/entry/61306>https://codeforces.com/blog/entry/61306</a><br><a href=https://www.cnblogs.com/zzqsblog/p/6877339.html>https://www.cnblogs.com/zzqsblog/p/6877339.html</a><br><a href=https://github.com/enkerewpo/OI-Public-Library/blob/master/IOI%E4%B8%AD%E5%9B%BD%E5%9B%BD%E5%AE%B6%E5%80%99%E9%80%89%E9%98%9F%E8%AE%BA%E6%96%871999-2019/%E5%9B%BD%E5%AE%B6%E9%9B%86%E8%AE%AD%E9%98%9F2019%E8%AE%BA%E6%96%87%E9%9B%86.pdf>https://github.com/enkerewpo/OI-Public-Library/blob/master/IOI%E4%B8%AD%E5%9B%BD%E5%9B%BD%E5%AE%B6%E5%80%99%E9%80%89%E9%98%9F%E8%AE%BA%E6%96%871999-2019/%E5%9B%BD%E5%AE%B6%E9%9B%86%E8%AE%AD%E9%98%9F2019%E8%AE%BA%E6%96%87%E9%9B%86.pdf</a></p><p>註：我遞迴、遞推等等用詞都搞不太清楚，不過我猜不重要吧XD<br>越來越毒的感覺了，該把路矯正回來喇ww<br>不知道會有多少人仔細看？抓typo不要鞭太用力QQ</p></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="omeletwithoutegg",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/about/>About</a></li><li><a href=/posts/>Posts</a></li><li><a href=/resources/>Resources</a></li><li><a href=/search/>Search</a></li><li><a href=/tags/>Tags</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#定義>定義</a></li><li><a href=#通靈>通靈</a></li><li><a href=#結論>結論</a></li></ul><ul><li><a href=#定義-1>定義</a></li><li><a href=#步驟>步驟</a></li><li><a href=#bm-演算法的應用>BM 演算法的應用！</a><ul><li><a href=#向量矩陣的slr>向量/矩陣的SLR</a></li><li><a href=#稀疏線性方程組>稀疏線性方程組</a></li><li><a href=#稠密的轉移矩陣>稠密的轉移矩陣</a></li><li><a href=#矩陣的最小多項式>矩陣的最小多項式</a></li><li><a href=#稀疏矩陣行列式>稀疏矩陣行列式</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&text=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&title=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&is_video=false&description=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87&body=Check out this article: https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&title=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&title=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&name=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87&description=%3cp%3e%e6%9c%ac%e7%af%87%e5%b0%87%e6%9c%83%e4%bb%8b%e7%b4%b9%e5%bf%ab%e9%80%9f%e6%b1%82%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%95%b8%e5%88%97%e6%9f%90%e9%a0%85%e7%9a%84%e6%96%b9%e6%b3%95%ef%bc%8c%e4%bb%a5%e5%8f%8aBerlekamp-Massey%e6%bc%94%e7%ae%97%e6%b3%95%e5%92%8c%e4%b8%80%e4%ba%9b%e5%9c%a8%e7%9f%a9%e9%99%a3%e4%b8%8a%e7%9a%84%e6%87%89%e7%94%a8%e3%80%82%3cbr%3e%0a%e4%b8%bb%e8%a6%81%e6%98%af%e4%b8%80%e5%80%8b%e6%95%b4%e7%90%86%e8%b3%87%e6%96%99%e9%82%84%e6%9c%89%e5%ad%b8%e7%bf%92%e7%ad%86%e8%a8%98%e7%9a%84%e5%8a%9f%e8%83%bd%ef%bc%8c%e9%82%84%e6%9c%89%e8%80%81%e5%af%a6%e8%aa%aa%e9%80%99%e6%9d%b1%e8%a5%bf%e7%ae%97%e6%98%af%e5%81%8f%e9%96%80%e5%8f%88%e6%af%92%e7%98%a4%ef%bc%8c%e8%bf%bd%e6%b1%82%e5%af%a6%e7%94%a8%e7%9a%84%e4%ba%ba%e4%b8%8d%e8%a6%81%e7%9c%8bXD%e3%80%82%3c%2fp%3e%0a%3ch1%20id%3d%22fast-linear-recurrence%22%3eFast%20Linear%20Recurrence%3c%2fh1%3e%0a%3cp%3e%e9%a6%96%e5%85%88%e5%85%88%e4%be%86%e4%bb%8b%e7%b4%b9%e5%a6%82%e4%bd%95%e5%bf%ab%e9%80%9f%e6%b1%82%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e3%80%82%3c%2fp%3e%0a%3ch2%20id%3d%22%e5%ae%9a%e7%be%a9%22%3e%e5%ae%9a%e7%be%a9%3c%2fh2%3e%0a%3cblockquote%3e%0a%3cp%3e%e5%b7%b2%e7%9f%a5%e5%ba%8f%e5%88%97%20%24%20%5clangle%20a_n%20%5crangle%20%24%20%e6%bb%bf%e8%b6%b3%e9%81%9e%e8%bf%b4%e9%97%9c%e4%bf%82%20%24%20%5cdisplaystyle%20%5cforall%20i%20%5cgeq%20k%2c%20a_i%20%3d%20%5csum%20_%20%7bj%3d0%7d%20%5e%20%7bk-1%7d%20s%20_%20j%20a%20_%20%7bi-1-j%7d%20%24%20%ef%bc%8c%e4%b8%a6%e4%b8%94%e5%b7%b2%e7%b6%93%e7%b5%a6%e5%ae%9a%20%24s%24%20%e8%b7%9f%20%24a_0%2c%20a_1%2c%20%5cdots%2c%20a%20_%20%7bk-1%7d%24%3cbr%3e%0a%e7%8f%be%e5%9c%a8%e6%83%b3%e8%a6%81%e6%b1%82%20%24%20a_n%20%24%20%e7%9a%84%e5%80%bc%ef%bc%8c%e5%85%b6%e4%b8%ad%20%24%201%20%5cleq%20k%20%5cleq%205000%2c%200%20%5cleq%20n%20%5cleq%2010%5e9%20%24%3c%2fp%3e%3c%2fblockquote%3e%0a%3cp%3e%e8%a8%b1%e5%a4%9a%e4%ba%ba%e5%a4%a7%e6%a6%82%e6%9c%83%e5%be%88%e5%bf%ab%e6%83%b3%e5%88%b0%e7%9f%a9%e9%99%a3%e5%bf%ab%e9%80%9f%e5%86%aa%ef%bc%8c%e8%a4%87%e9%9b%9c%e5%ba%a6%e6%98%af%20%24%20%5cmathcal%7bO%7d%28k%5e3%20%5clog%20n%29%20%24%e3%80%82%e4%bd%86%e6%88%91%e5%80%91%e8%a6%81%e6%9b%b4%e5%bf%ab%ef%bc%81%3c%2fp%3e%0a%3ch2%20id%3d%22%e9%80%9a%e9%9d%88%22%3e%e9%80%9a%e9%9d%88%3c%2fh2%3e%0a%3cp%3e%e5%ae%9a%e7%be%a9%e4%b8%80%e5%80%8b%e5%87%bd%e6%95%b8%20%24G%24%ef%bc%8c%e5%b0%8d%e6%96%bc%e5%bd%a2%e5%bc%8f%e5%86%aa%e7%b4%9a%e6%95%b8%20%24f%28x%29%20%3d%20%5csum%20c_i%20x%5ei%2c%20G%28f%29%20%3d%20%5csum%20c_i%20a_i%24%20%e3%80%82%3cbr%3e%0a%e9%a1%af%e7%84%b6%24G%28f%20%5cpm%20g%29%20%3d%20G%28f%29%20%5cpm%20G%28g%29%24%e3%80%82%3cbr%3e%0a%e6%a0%b9%e6%93%9a%20%24s%24%20%e6%a7%8b%e9%80%a0%e4%b8%80%e5%80%8b%e5%a4%9a%e9%a0%85%e5%bc%8f%20%24S%24%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fomeletwithoutegg.github.io%2f2021%2f02%2f13%2flinear-recurrence%2f&t=%e7%b7%9a%e6%80%a7%e9%81%9e%e8%bf%b4%e6%b7%ba%e6%b7%ba%e8%ab%87" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2025 Omelet</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/about/>About</a></li><li><a href=/posts/>Posts</a></li><li><a href=/resources/>Resources</a></li><li><a href=/search/>Search</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div></footer></div><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script src=/lib/clipboard/clipboard.min.js></script><script>$(function(){let e='<span class="btn-copy tooltipped tooltipped-sw" aria-label="Copy to clipboard!" style="z-index: 9999">';e+='<i class="far fa-clone"></i>',e+="</span>",$(".highlight table").before(e);const t=new ClipboardJS(".btn-copy",{text:function(e){const t='code[data-lang]:not([data-lang=""]) > span',n=Array.from(e.nextElementSibling.querySelectorAll(t)),s=n.map(e=>e.innerText).join("");return s}});t.on("success",function(e){e.trigger.setAttribute("aria-label","Copied!"),e.clearSelection()}),t.on("error",function(e){console.error("Action:",e.action),console.error("Trigger:",e.trigger)})})</script><script type=text/javascript src=/js/canvas-nest.js count=90 color=0,200,100 opacity=0.5></script></body></html>